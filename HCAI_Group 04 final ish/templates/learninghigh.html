<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Animal Classification Results</title>

<style>
/* ---- GLOBAL ---- */
body {
  font-family: Arial, sans-serif;
  background: #f7f7fb;
  margin: 0;
  padding: 1rem;
  color: #2d2d2d;
}

.container {
  max-width: 1400px;
  margin: auto;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.card {
  background: white;
  border-radius: 20px;
  padding: 1.5rem;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

/* ---- TOP SECTION WRAPPER ---- */
.top-grid {
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: 1.5rem;
}

/* ---- IMAGE + HEATMAP CARD ---- */
.image-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
}
.image-card img {
  width: 180px;
  height: 180px;
  object-fit: contain;
  border-radius: 1rem;
}
.heatmap-btn {
  margin-top: 1rem;
  background: #4a4aff;
  color: white;
  border: none;
  padding: 0.7rem 1.2rem;
  border-radius: 10px;
  cursor: pointer;
  font-size: 1rem;
}
.heatmap-box {
  background: #ffecec;
  border-radius: 12px;
  padding: 1rem;
  margin-top: 1rem;
  text-align: left;
  font-size: 0.9rem;
}

/* ---- RESULTS CARD ---- */
.result-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 0.5rem 0;
  font-size: 1rem;
}
.bar-bg {
  width: 100%;
  height: 10px;
  background: #e3e3e3;
  border-radius: 10px;
  overflow: hidden;
  margin-left: 1rem;
}
.bar-fill {
  height: 100%;
  border-radius: 10px;
}
.dog { background: #4caf50; }
.fox { background: #ff9800; }
.wolf { background: #f44336; }

.range-box {
  margin-top: 1rem;
}

/* ---- MIDDLE SECTION ---- */
.mid-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
}

.feature-item {
  background: #fff;
  padding: 1rem;
  border-radius: 12px;
  border-left: 6px solid #4caf50;
  margin-bottom: 1rem;
}

/* ---- BOTTOM BUTTONS ---- */
.bottom-btns {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin-top: 1rem;
}
.bottom-btns button {
  padding: 0.8rem 1.6rem;
  background: #4a4aff;
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-size: 1rem;
}

/* ---- RESPONSIVE ---- */
@media (max-width: 900px) {
  .top-grid {
    grid-template-columns: 1fr;
  }
  .mid-grid {
    grid-template-columns: 1fr;
  }
}
</style>

</head>
<body>

<!-- Top Navigation Bar -->
<nav class="side-nav">
  <div class="nav-right">
  </div>
  <div class="nav-right">
    <button onclick="goToHome()">Home</button>
    <button onclick="goToExplainability()">Explainability</button>
  </div>
</nav>

<div class="container">
  <!-- Your existing page content goes here -->
</div>

<div class="container">

  <!-- TOP GRID SECTION -->
  <div class="top-grid">

    <!-- IMAGE CARD -->
    <div class="card image-card">
      <img id="previewImage" src="" alt="Uploaded Image" />
      <h2 id="predictionTitle">Animal Prediction</h2>

      <img id="GradCamImage" src="" alt="Uploaded Image" />
      <div class="heatmap-box">
        <strong>üî• Attention Heatmap</strong>
        <p>Red/yellow areas show where the AI focused most attention.</p>
        <div>Resolution: 512√ó512</div>
        <div>Processing time: 0.3s</div>
      </div>
    </div>

    <!-- CLASSIFICATION RESULTS -->
    <div class="card">
      <h2>Classification Results</h2>

      <div class="result-row">
        <span>{{ most_likely }}</span>
        <span style="color:#4caf50; font-weight:bold;">87%</span>
      </div>
      <div class="bar-bg">
        <div class="bar-fill dog" style="width:87%;"></div>
      </div>

      <div class="result-row">
        <span>Fox</span>
        <span style="color:#ff9800; font-weight:bold;">8%</span>
      </div>
      <div class="bar-bg">
        <div class="bar-fill fox" style="width:8%;"></div>
      </div>

      <div class="result-row">
        <span>Wolf</span>
        <span style="color:#f44336; font-weight:bold;">5%</span>
      </div>
      <div class="bar-bg">
        <div class="bar-fill wolf" style="width:5%;"></div>
      </div>

      <div class="container">
        <h3>What does using a high learning rate do?</h3>
        <p>The learning rate in a CNN model controls the rate at which the parameters are changed over each iteration. It works with the loss of each prediction (the amount that the model was off on the prediction) and updates the parameters based mainly on those two values (the formula for this model is new_parameter = old_parameter - (learning_rate √ó loss). There isn't a set 'best' learning rate, as lower rates cause the model to train much slower, and be more likely to get stuck at suboptimal points, whereas higher rates can cause the parameters to overshoot, making getting an accurate model much harder.</p>
        <p>Having a high learning rate in this case would likely refer to a rate of between 0.001 and 0.01. This will affect the outcome/predictions and likely in a negative way. Having this higher learning rate makes the model train itself very erratically, changing parameters in a far more drastic way than what would be efficient. As stated before, this can lead to overshooting, plus if the model is unable to find a place where it feels accurate, then the accuracy will suffer greatly.</p>
        <button onclick="window.location.href='{{ url_for('learninglow') }}'" style="flex: 1; padding: 0.7rem; background: #4a4aff; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9rem;">Try with Low Learning Rate!</button>
        <div style="display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap;">
          <button onclick="goToEpoch50()" style="flex: 1; padding: 0.7rem; background: #4a4aff; color: white; border: none; border-radius: 8px; cursor: pointer;">Try with 50 epochs!</button>
          <button onclick="goToEpoch100()" style="flex: 1; padding: 0.7rem; background: #4a4aff; color: white; border: none; border-radius: 8px; cursor: pointer;">Try with 100 epochs!</button>
          <button onclick="goToEpoch200()" style="flex: 1; padding: 0.7rem; background: #4a4aff; color: white; border: none; border-radius: 8px; cursor: pointer;">Try with 200 epochs!</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MIDDLE GRID SECTION -->
  <div class="mid-grid">

    <div class="card">
      <h3>‚ùì Why This Classification?</h3>
      <p id="explanationText">The model identified this as a dog with high confidence based on distinctive domestic dog features including floppy ears and a visible collar.</p>

    </div>

    <div class="card">
      <h3>‚¨ÖÔ∏è How was this explanation generated?</h3>
      <p>This explanation has been generated by a Large Language Model (LLM) - an AI trained on very large amounts of text in order to understand and generate human language. When the image classifier makes a prediction, three main pieces of information are sent to the LLM: the top predictions with their confidence scores, the original image, and the heatmap, which shows the areas in the image the classifier focused on.</p>
      <p>The LLM analyses these inputs and generates an explanation by recognising patterns between the classifier's prediction and the typical visual features of the predicted animal. It looks at the animals predicted, the confidence levels and the heatmap to figure out whether the prediction makes sense.</p>
    </div>


  </div>

<script>
function goToHome() {
    window.location.href = "{{ url_for('home') }}";
}
function goToComparison() {
    window.location.href = "{{ url_for('comparison') }}";
}
function goToExplainability() {
    window.location.href = "{{ url_for('explanability') }}";
}
function goToEpoch50() {
    window.location.href = "{{ url_for('epoch50') }}";
}
function goToEpoch100() {
    window.location.href = "{{ url_for('epoch100') }}";
}
function goToEpoch200() {
    window.location.href = "{{ url_for('epoch200') }}";
}
function goToLearningLow() {
    window.location.href = "{{ url_for('learninglow') }}";
}
function goToLearningHigh() {
    window.location.href = "{{ url_for('learninghigh') }}";
}
</script>

<script>
// Store predicted animal in localStorage on page load
document.addEventListener('DOMContentLoaded', function() {
    const predictedAnimal = "Dog"; // replace dynamically with actual prediction
    localStorage.setItem("predictedAnimal", predictedAnimal);
});
</script>
  </div>

</div>

<!-- ---------- LOAD UPLOADED IMAGE FROM LOCAL STORAGE ---------- -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    const img = document.getElementById("previewImage");

    const savedFilename = localStorage.getItem("uploadedFilename");

    if (savedFilename) {
        img.src = "/uploads/" + savedFilename;
    } else {
        img.src = "static/default.png";
    }

    const gradcam = document.getElementById("GradCamImage");
    const gradcamFilename = localStorage.getItem("gradcam_filename");
    if (gradcamFilename) {
        gradcam.src = "/gradcams/" + gradcamFilename;
    } else {
        gradcam.src = "static/default.png";
    }

    const mostLikely = localStorage.getItem("most_likely");
    const mostLikelyProb = localStorage.getItem("most_likely_prob");
    const mostLikelyProb50 = localStorage.getItem("most_likely_prob_50");
    const mostLikelyProb200 = localStorage.getItem("most_likely_prob_200");
    const secondMost = localStorage.getItem("second_most");
    const secondMostProb = localStorage.getItem("second_most_prob");
    const secondMostProb50 = localStorage.getItem("second_most_prob_50");
    const thirdMost = localStorage.getItem("third_most");
    const thirdMostProb = localStorage.getItem("third_most_prob");
    const thirdMostProb50 = localStorage.getItem("third_most_prob_50");
    const thirdMostProb200 = localStorage.getItem("third_most_prob_200");
    const mostLikelyProbHigh = localStorage.getItem("most_likely_prob_high");
    const secondMostProbHigh = localStorage.getItem("second_most_prob_high");
    const thirdMostProbHigh = localStorage.getItem("third_most_prob_high");

    document.getElementById("predictionTitle").textContent = mostLikely;


    const results = document.querySelectorAll('.result-row');

    // First result
    results[0].querySelector('span:first-child').textContent = mostLikely;
    results[0].querySelector('span:last-child').textContent = mostLikelyProbHigh + '%';
    results[0].nextElementSibling.querySelector('.bar-fill').style.width = mostLikelyProbHigh + '%';

    // Second result
    results[1].querySelector('span:first-child').textContent = secondMost;
    results[1].querySelector('span:last-child').textContent = secondMostProbHigh + '%';
    results[1].nextElementSibling.querySelector('.bar-fill').style.width = secondMostProbHigh + '%';

    // Third result
    results[2].querySelector('span:first-child').textContent = thirdMost;
    results[2].querySelector('span:last-child').textContent = thirdMostProbHigh + '%';
    results[2].nextElementSibling.querySelector('.bar-fill').style.width = thirdMostProbHigh + '%';

    // Inject LLM explanation into text box
    const explanation = localStorage.getItem("explanation")
    document.getElementById("explanationText").textContent = explanation


});
</script>

</body>
</html>